<form theme="dark">
  <label>ITSI KPI Analysis (With Base Searches)</label>
  <search id="historical">
    <query>index=itsi_summary $kpiid$ is_service_max_severity_event=0 | table *</query>
    <earliest>$field1.earliest$</earliest>
    <latest>$field1.latest$</latest>
    <sampleRatio>1</sampleRatio>
    <finalized>
      <condition match="'job.resultCount' != 0">
        <set token="kpiid_val">$result.kpiid$</set>
        <set token="serviceid_val">$result.serviceid$</set>
      </condition>
    </finalized>
  </search>
  <search id="dynamic">
    <query>index=itsi_summary $kpiid$ is_service_max_severity_event=0 alert_value=* alert_severity=* alert_level=* date_hour=* date_wday=* | `assess_severity($serviceid_val$, $kpiid_val$)` | table *</query>
    <earliest>$field1.earliest$</earliest>
    <latest>$field1.latest$</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="adjusted">
    <query>index=itsi_summary $kpiid$ is_service_max_severity_event=0 alert_value=* alert_severity=* alert_level=* date_hour=* date_wday=*
| eval alert_value = alert_value * $av_multiplier$
| `assess_severity($serviceid_val$, $kpiid_val$)` | table *</query>
    <earliest>$field1.earliest$</earliest>
    <latest>$field1.latest$</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <fieldset submitButton="false">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="kpiid">
      <label>KPI</label>
      <fieldForLabel>name</fieldForLabel>
      <fieldForValue>key</fieldForValue>
      <search>
        <query>| inputlookup service_kpi_lookup
| eval mvzip = mvzip('kpis._key', 'kpis.title')
| mvexpand mvzip
| eval mvzip = split(mvzip,",")
| eval key = mvindex(mvzip, 0)
| eval name = mvindex(mvzip,1)
| eval name = title."-".name</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <prefix>kpiid=</prefix>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
        <h1>Overall KPI Health</h1>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>KPI Frequency Actual vs Expected</title>
      <chart>
        <search base="historical">
          <query>| timechart count span=1h
| eval expected_count=12</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>KPI Result Timestamp Minute of Hour</title>
      <chart>
        <search base="historical">
          <query>| eval stamp_min = strftime(_time, "%M")
| stats count by stamp_min
| makecontinuous stamp_min</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h1>Historical KPI Results and Performance</h1>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Distribution of KPI Severity</title>
      <chart>
        <search base="historical">
          <query>| top alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>KPI Severities over Time</title>
      <chart>
        <search base="historical">
          <query>| eventstats perc50(alert_value) as p90_alert_value
| eval alert_value = if(alert_level&gt;0, alert_value, -1*p90_alert_value)
| timechart max(alert_value) as alert_value span=5m@5m by alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.overlayFields">normal</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>KPI Alert Value Delta (Result to Result)</title>
      <chart>
        <search base="historical">
          <query>| eval alert_value = if(alert_level&gt;0, alert_value, -1)
| sort _time
| delta alert_value as alert_value_delta
| timechart span=5m max(alert_value_delta) as alert_value_delta by alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Distribution of KPI Severities by Hour of Day and Day of Week (Color coded by most severe result per group)</title>
      <input type="multiselect" token="severity">
        <label>Severities</label>
        <choice value="2">Normal</choice>
        <choice value="1">Info</choice>
        <choice value="3">Low</choice>
        <choice value="4">Medium</choice>
        <choice value="5">High</choice>
        <choice value="6">Critical</choice>
        <choice value="-1">Unknown</choice>
        <prefix>alert_level IN (</prefix>
        <suffix>)</suffix>
        <initialValue>5,6</initialValue>
        <delimiter>,</delimiter>
      </input>
      <viz type="punchcard_app.punchcard">
        <search base="historical">
          <query>| eval is_abnormal = if(searchmatch("$severity$"),1,null())
| eval abnormal_level = if(is_abnormal=1, alert_level, 0)
| stats count(is_abnormal) as is_abnormal max(abnormal_level) as max_abnormal_level by date_hour date_wday</query>
        </search>
        <option name="drilldown">none</option>
        <option name="punchcard_app.punchcard.colorMode">sequential</option>
        <option name="punchcard_app.punchcard.labelRotation">horizontal</option>
        <option name="punchcard_app.punchcard.maxColor">#dc4e41</option>
        <option name="punchcard_app.punchcard.minColor">#D3D3D3</option>
        <option name="punchcard_app.punchcard.numOfBins">9</option>
        <option name="punchcard_app.punchcard.radiusScale">global</option>
        <option name="punchcard_app.punchcard.useColors">true</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h1>Dynamically Computed KPI Results and Performance</h1>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Distribution of KPI Severity</title>
      <chart>
        <search base="dynamic">
          <query>| top alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>KPI Severities over Time</title>
      <chart>
        <search base="dynamic">
          <query>| eventstats perc50(alert_value) as p90_alert_value
| eval alert_value = if(alert_level&gt;0, alert_value, -1*p90_alert_value)
| timechart max(alert_value) as alert_value span=5m@5m by alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.overlayFields">normal</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>KPI Alert Value Delta (Result to Result)</title>
      <chart>
        <search base="dynamic">
          <query>| eval alert_value = if(alert_level&gt;0, alert_value, -1)
| sort _time
| delta alert_value as alert_value_delta
| timechart span=5m max(alert_value_delta) as alert_value_delta by alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Distribution of KPI Severities by Hour of Day and Day of Week (Color coded by most severe result per group)</title>
      <input type="multiselect" token="dyn_severity">
        <label>Severities</label>
        <choice value="2">Normal</choice>
        <choice value="1">Info</choice>
        <choice value="3">Low</choice>
        <choice value="4">Medium</choice>
        <choice value="5">High</choice>
        <choice value="6">Critical</choice>
        <choice value="-1">Unknown</choice>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <initialValue>5,6</initialValue>
        <delimiter> OR </delimiter>
        <valuePrefix>alert_level=</valuePrefix>
      </input>
      <viz type="punchcard_app.punchcard">
        <search base="dynamic">
          <query>| eval is_abnormal = if($dyn_severity$,1,null())
| eval abnormal_level = if(is_abnormal=1, alert_level, 0)
| stats count(is_abnormal) as is_abnormal max(abnormal_level) as max_abnormal_level by date_hour date_wday</query>
        </search>
        <option name="drilldown">none</option>
        <option name="punchcard_app.punchcard.colorMode">sequential</option>
        <option name="punchcard_app.punchcard.labelRotation">horizontal</option>
        <option name="punchcard_app.punchcard.maxColor">#dc4e41</option>
        <option name="punchcard_app.punchcard.minColor">#D3D3D3</option>
        <option name="punchcard_app.punchcard.numOfBins">9</option>
        <option name="punchcard_app.punchcard.radiusScale">global</option>
        <option name="punchcard_app.punchcard.useColors">true</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <input type="text" token="av_multiplier">
        <label>Alert Value Multiplier</label>
        <default>1.0</default>
      </input>
      <html>
        <h1>Adjustable KPI Values Dynamically Computed KPI Results and Performance</h1>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Distribution of KPI Severity</title>
      <chart>
        <search base="adjusted">
          <query>| top alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>KPI Severities over Time</title>
      <chart>
        <search base="adjusted">
          <query>| eventstats perc50(alert_value) as p90_alert_value
| eval alert_value = if(alert_level&gt;0, alert_value, -1*p90_alert_value)
| timechart max(alert_value) as alert_value span=5m@5m by alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.overlayFields">normal</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>KPI Alert Value Delta (Result to Result)</title>
      <chart>
        <search base="adjusted">
          <query>| eval alert_value = if(alert_level&gt;0, alert_value, -1)
| sort _time
| delta alert_value as alert_value_delta
| timechart span=5m max(alert_value_delta) as alert_value_delta by alert_severity</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"normal":#99D18B, "critical":#B50101, "high":#F26A35, "medium":#FCB64E, "low":#FFE98C, "info":#AED3E5, "unknown":#A9A9A9}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Distribution of KPI Severities by Hour of Day and Day of Week (Color coded by most severe result per group)</title>
      <input type="multiselect" token="adj_severity">
        <label>Severities</label>
        <choice value="2">Normal</choice>
        <choice value="1">Info</choice>
        <choice value="3">Low</choice>
        <choice value="4">Medium</choice>
        <choice value="5">High</choice>
        <choice value="6">Critical</choice>
        <choice value="-1">Unknown</choice>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <initialValue>5,6</initialValue>
        <delimiter> OR </delimiter>
        <valuePrefix>alert_level=</valuePrefix>
      </input>
      <viz type="punchcard_app.punchcard">
        <search base="adjusted">
          <query>| eval is_abnormal = if($adj_severity$,1,null())
| eval abnormal_level = if(is_abnormal=1, alert_level, 0)
| stats count(is_abnormal) as is_abnormal max(abnormal_level) as max_abnormal_level by date_hour date_wday</query>
        </search>
        <option name="drilldown">none</option>
        <option name="punchcard_app.punchcard.colorMode">sequential</option>
        <option name="punchcard_app.punchcard.labelRotation">horizontal</option>
        <option name="punchcard_app.punchcard.maxColor">#dc4e41</option>
        <option name="punchcard_app.punchcard.minColor">#D3D3D3</option>
        <option name="punchcard_app.punchcard.numOfBins">9</option>
        <option name="punchcard_app.punchcard.radiusScale">global</option>
        <option name="punchcard_app.punchcard.useColors">true</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
</form>
